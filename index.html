<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suivi de bankroll</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    
    <style>
        /* [VOTRE CSS EXISTANT - CONSERVEZ TOUT LE STYLE ACTUEL] */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1800px; margin: 0 auto; }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .tabs { background: white; border-radius: 12px 12px 0 0; display: flex; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .tab-button { flex: 1; padding: 18px 20px; background: white; border: none; cursor: pointer; font-size: 1rem; font-weight: 600; color: #6b7280; border-bottom: 3px solid transparent; transition: all 0.3s; }
        .tab-button:hover { background: #f9fafb; color: #3b82f6; }
        .tab-button.active { color: #3b82f6; border-bottom-color: #3b82f6; background: #eff6ff; }
        .tab-content { display: none; background: white; padding: 30px; border-radius: 0 0 12px 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .tab-content.active { display: block; }
        .card { background: white; padding: 25px; border-radius: 12px; margin-bottom: 20px; }
        .card-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 10px; }
        .card-description { color: #6b7280; margin-bottom: 20px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .form-group { display: flex; flex-direction: column; position: relative; }
        label { font-weight: 600; margin-bottom: 8px; color: #374151; }
        input, select { padding: 12px 15px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; font-family: inherit; }
        input:focus, select:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-primary:hover { background: #2563eb; }
        .btn-success { background: #22c55e; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-secondary { background: #6b7280; color: white; }
        .btn-warning { background: #f59e0b; color: white; }
        .btn-info { background: #06b6d4; color: white; }
        .btn-sm { padding: 6px 12px; font-size: 0.875rem; }
        .btn-block { width: 100%; }
        .gain-display { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color: white; padding: 15px; border-radius: 8px; font-size: 1.5rem; font-weight: 700; text-align: center; }
        .autocomplete-container { position: relative; }
        .autocomplete-results { display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 2px solid #3b82f6; border-top: none; border-radius: 0 0 8px 8px; max-height: 300px; overflow-y: auto; z-index: 100; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .autocomplete-results.active { display: block; }
        .autocomplete-item { padding: 12px 15px; cursor: pointer; border-bottom: 1px solid #f3f4f6; }
        .autocomplete-item:hover { background: #eff6ff; }
        .match-info { font-weight: 600; color: #1f2937; }
        .match-meta { font-size: 0.875rem; color: #6b7280; margin-top: 4px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.9rem; }
        th { background: #f9fafb; padding: 12px 8px; text-align: left; font-weight: 600; border-bottom: 2px solid #e5e7eb; white-space: nowrap; }
        td { padding: 12px 8px; border-bottom: 1px solid #f3f4f6; vertical-align: top; }
        tr:hover { background: #f9fafb; }
        .badge { display: inline-block; padding: 4px 8px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; }
        .badge-success { background: #dcfce7; color: #166534; }
        .badge-danger { background: #fee2e2; color: #991b1b; }
        .badge-warning { background: #fed7aa; color: #9a3412; }
        .badge-info { background: #dbeafe; color: #1e40af; }
        .badge-secondary { background: #f3f4f6; color: #374151; }
        .bookmaker-list { display: grid; gap: 15px; margin-bottom: 20px; }
        .bookmaker-item { display: flex; justify-content: space-between; align-items: center; padding: 20px; background: #f9fafb; border-radius: 8px; border: 2px solid #e5e7eb; }
        .bookmaker-name { font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
        .bookmaker-balance { color: #6b7280; }
        .bookmaker-current { font-size: 1.5rem; font-weight: 700; color: #3b82f6; margin-right: 20px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; padding: 25px; border-radius: 12px; }
        .stat-card.green { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); }
        .stat-card.red { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .stat-card.purple { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
        .stat-label { font-size: 0.95rem; opacity: 0.9; margin-bottom: 8px; }
        .stat-value { font-size: 2rem; font-weight: 700; }
        .action-buttons { display: flex; gap: 4px; flex-wrap: wrap; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; padding: 30px; border-radius: 12px; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .modal-header { font-size: 1.5rem; font-weight: 700; margin-bottom: 20px; }
        .modal-buttons { display: flex; gap: 10px; margin-top: 20px; }
        .edit-mode-banner { background: #fef3c7; color: #92400e; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-weight: 600; text-align: center; }
        .reset-zone { margin-top: 30px; padding-top: 30px; border-top: 2px solid #fee2e2; }
        .export-buttons { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .tipster-card { background: #f9fafb; padding: 20px; border-radius: 8px; border: 2px solid #e5e7eb; margin-bottom: 15px; cursor: pointer; transition: all 0.2s; }
        .tipster-card:hover { border-color: #3b82f6; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15); }
        .tipster-card.selected { border-color: #3b82f6; background: #eff6ff; }
        .tipster-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .tipster-name { font-size: 1.3rem; font-weight: 700; color: #1f2937; }
        .tipster-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; font-size: 0.9rem; }
        .tipster-stat { text-align: center; }
        .tipster-stat-value { font-weight: 700; color: #3b82f6; }
        .tipster-stat-label { color: #6b7280; font-size: 0.85rem; }
        .sport-icon { width: 20px; height: 20px; display: inline-block; text-align: center; font-weight: bold; margin-right: 5px; }
        
        /* Styles pour Firebase Auth */
        .auth-container { background: white; padding: 30px; border-radius: 12px; margin-bottom: 20px; text-align: center; }
        .user-info { background: #eff6ff; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .sync-status { position: fixed; top: 20px; right: 20px; background: white; padding: 10px 15px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; font-size: 0.9rem; }
        .sync-status.syncing { background: #fef3c7; color: #92400e; }
        .sync-status.synced { background: #dcfce7; color: #166534; }
        .sync-status.error { background: #fee2e2; color: #991b1b; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Barre de statut de synchronisation -->
        <div class="sync-status" id="syncStatus" style="display: none;">
            üîÑ Synchronisation...
        </div>

        <div class="header">
            <h1>üí∞ Suivi de bankroll</h1>
            <p>G√©rez vos paris sportifs et suivez vos performances</p>
        </div>

        <!-- Section Authentification -->
        <div class="auth-container" id="authContainer">
            <h2>üîê Connexion</h2>
            <p>Connectez-vous pour synchroniser vos donn√©es sur tous vos appareils</p>
            <div class="form-grid" style="max-width: 400px; margin: 20px auto;">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="authEmail" placeholder="votre@email.com">
                </div>
                <div class="form-group">
                    <label>Mot de passe</label>
                    <input type="password" id="authPassword" placeholder="Votre mot de passe">
                </div>
            </div>
            <button class="btn btn-primary" onclick="login()">Se connecter</button>
            <button class="btn btn-secondary" onclick="signup()">Cr√©er un compte</button>
            <div style="margin-top: 15px; font-size: 0.9rem; color: #6b7280;">
                <p>Ou utilisez un compte anonyme :</p>
                <button class="btn btn-info btn-sm" onclick="loginAnonymously()">Utiliser sans compte</button>
            </div>
        </div>

        <!-- Info utilisateur connect√© -->
        <div class="user-info" id="userInfo" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <strong>Connect√© en tant que :</strong> 
                    <span id="userEmail"></span>
                    <span id="userAnonymous" style="font-style: italic; color: #6b7280;"></span>
                </div>
                <button class="btn btn-danger btn-sm" onclick="logout()">D√©connexion</button>
            </div>
        </div>

        <!-- Le reste de votre application (identique) -->
        <div class="tabs" id="mainTabs" style="display: none;">
            <!-- [VOS TABS EXISTANTS - CONSERVEZ TOUT] -->
            <button class="tab-button active" data-tab="enregistrer">Enregistrer</button>
            <button class="tab-button" data-tab="suivi-operations">Suivi des op√©rations</button>
            <button class="tab-button" data-tab="tipsters">Tipsters</button>
            <button class="tab-button" data-tab="bookmakers">Bookmakers</button>
            <button class="tab-button" data-tab="statistiques">Statistiques</button>
            <button class="tab-button" data-tab="outils">Outils</button>
            <button class="tab-button" data-tab="reglages">R√©glages</button>
        </div>
        
        <!-- [TOUS VOS CONTENUS DE TABS EXISTANTS - CONSERVEZ TOUT] -->
        <div class="tab-content active" id="enregistrer">
            <!-- Votre contenu existant -->
        </div>
        
        <div class="tab-content" id="suivi-operations">
            <!-- Votre contenu existant -->
        </div>
        
        <!-- ... autres onglets ... -->
    </div>

    <!-- [VOS MODALS EXISTANTS] -->
    <div class="modal" id="cashoutModal">
        <!-- Votre contenu existant -->
    </div>

    <script>
        // === CONFIGURATION FIREBASE ===
        // REMPLACEZ CES VALEURS PAR VOS PROPRES CL√âS FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyDbtGDuOVE4lYkVtLjZ0AnrpbWVnwcdvZI",
            authDomain: "bankroll-suivi.firebaseapp.com",
            databaseURL: "https://VOTRE_PROJET.firebaseio.com",
            projectId: "bankroll-suivi",
            storageBucket: "bankroll-suivi.firebasestorage.app",
            messagingSenderId: "632546496211",
            appId: "1:632546496211:web:25375f3e496c4a43490e26"
        };

        // Initialisation Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Variables globales
        let bookmakers = [];
        let operations = [];
        let tipsters = [];
        let searchTimeout = null;
        let currentCashoutId = null;
        let editingOperationId = null;
        let editingTipsterId = null;
        let editingBookmakerId = null;
        let isSyncing = false;
        let currentUser = null;

        const mockMatches = [
            {sport: 'Football', home: 'Barnsley', away: 'Lincoln', date: '2025-11-15', time: '20:00'},
            {sport: 'Football', home: 'PSG', away: 'OM', date: '2025-11-16', time: '21:00'},
            {sport: 'Football', home: 'Real Madrid', away: 'Barcelona', date: '2025-11-17', time: '20:00'},
            {sport: 'Football', home: 'Manchester United', away: 'Liverpool', date: '2025-11-18', time: '17:30'},
            {sport: 'Football', home: 'Bayern', away: 'Dortmund', date: '2025-11-19', time: '18:30'},
            {sport: 'Football', home: 'Arsenal', away: 'Chelsea', date: '2025-11-22', time: '16:00'}
        ];

        const sportIcons = {
            'Football': '‚öΩ', 'Basketball': 'üèÄ', 'Tennis': 'üéæ', 'Rugby': 'üèâ',
            'Hockey': 'üèí', 'Volley': 'üèê', 'F1': 'üèéÔ∏è', 'Baseball': '‚öæ',
            'Golf': '‚õ≥', 'Boxe': 'ü•ä'
        };

        // === GESTION AUTHENTIFICATION ===
        function showAuthUI() {
            document.getElementById('authContainer').style.display = 'block';
            document.getElementById('userInfo').style.display = 'none';
            document.getElementById('mainTabs').style.display = 'none';
        }

        function showAppUI(user) {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('userInfo').style.display = 'block';
            document.getElementById('mainTabs').style.display = 'flex';
            
            const userEmail = document.getElementById('userEmail');
            const userAnonymous = document.getElementById('userAnonymous');
            
            if (user.isAnonymous) {
                userEmail.textContent = '';
                userAnonymous.textContent = 'Compte anonyme';
            } else {
                userEmail.textContent = user.email;
                userAnonymous.textContent = '';
            }
            
            // Charger les donn√©es apr√®s connexion
            loadUserData();
        }

        async function login() {
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            
            if (!email || !password) {
                alert('Veuillez remplir tous les champs');
                return;
            }
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
                showSyncStatus('‚úÖ Connect√©', 'synced');
            } catch (error) {
                alert('Erreur de connexion: ' + error.message);
            }
        }

        async function signup() {
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            
            if (!email || !password) {
                alert('Veuillez remplir tous les champs');
                return;
            }
            
            if (password.length < 6) {
                alert('Le mot de passe doit contenir au moins 6 caract√®res');
                return;
            }
            
            try {
                await auth.createUserWithEmailAndPassword(email, password);
                showSyncStatus('‚úÖ Compte cr√©√©', 'synced');
            } catch (error) {
                alert('Erreur de cr√©ation de compte: ' + error.message);
            }
        }

        async function loginAnonymously() {
            try {
                await auth.signInAnonymously();
                showSyncStatus('‚úÖ Session anonyme d√©marr√©e', 'synced');
            } catch (error) {
                alert('Erreur de connexion anonyme: ' + error.message);
            }
        }

        async function logout() {
            try {
                // Sauvegarder les donn√©es avant d√©connexion
                await saveDataToFirebase();
                await auth.signOut();
                showAuthUI();
            } catch (error) {
                alert('Erreur de d√©connexion: ' + error.message);
            }
        }

        // === GESTION DES DONN√âES FIREBASE ===
        function getUserDataPath() {
            if (!currentUser) return null;
            return `users/${currentUser.uid}`;
        }

        async function saveDataToFirebase() {
            if (!currentUser || isSyncing) return;
            
            isSyncing = true;
            showSyncStatus('üîÑ Synchronisation...', 'syncing');
            
            try {
                const userDataPath = getUserDataPath();
                const data = {
                    bookmakers: bookmakers,
                    operations: operations,
                    tipsters: tipsters,
                    lastSync: firebase.database.ServerValue.TIMESTAMP
                };
                
                await database.ref(userDataPath).set(data);
                showSyncStatus('‚úÖ Donn√©es synchronis√©es', 'synced');
                
                // Sauvegarder aussi en localStorage comme backup
                saveDataToLocalStorage();
            } catch (error) {
                console.error('Erreur synchronisation:', error);
                showSyncStatus('‚ùå Erreur synchronisation', 'error');
            } finally {
                setTimeout(() => {
                    isSyncing = false;
                    document.getElementById('syncStatus').style.display = 'none';
                }, 2000);
            }
        }

        async function loadUserData() {
            if (!currentUser) return;
            
            showSyncStatus('üîÑ Chargement...', 'syncing');
            
            try {
                const userDataPath = getUserDataPath();
                const snapshot = await database.ref(userDataPath).once('value');
                const data = snapshot.val();
                
                if (data) {
                    // Donn√©es Firebase trouv√©es
                    bookmakers = data.bookmakers || [];
                    operations = data.operations || [];
                    tipsters = data.tipsters || [];
                    showSyncStatus('‚úÖ Donn√©es charg√©es', 'synced');
                } else {
                    // Aucune donn√©e Firebase, essayer localStorage
                    loadDataFromLocalStorage();
                    // Sauvegarder les donn√©es locales vers Firebase
                    await saveDataToFirebase();
                }
                
                updateUI();
            } catch (error) {
                console.error('Erreur chargement:', error);
                // En cas d'erreur, charger depuis localStorage
                loadDataFromLocalStorage();
                updateUI();
                showSyncStatus('‚ö†Ô∏è Donn√©es locales charg√©es', 'synced');
            }
        }

        function showSyncStatus(message, type) {
            const statusEl = document.getElementById('syncStatus');
            statusEl.textContent = message;
            statusEl.className = `sync-status ${type}`;
            statusEl.style.display = 'block';
        }

        // === FONCTIONS EXISTANTES MODIFI√âES ===
        function saveData() {
            saveDataToLocalStorage();
            if (currentUser) {
                saveDataToFirebase();
            }
        }

        function saveDataToLocalStorage() {
            localStorage.setItem('bookmakers', JSON.stringify(bookmakers));
            localStorage.setItem('operations', JSON.stringify(operations));
            localStorage.setItem('tipsters', JSON.stringify(tipsters));
        }

        function loadDataFromLocalStorage() {
            const saved = localStorage.getItem('bookmakers');
            if (saved) { 
                bookmakers = JSON.parse(saved); 
            } else {
                bookmakers = [
                    {id: 1, nom: 'Loro', soldeInitial: 100},
                    {id: 2, nom: 'bet365', soldeInitial: 100},
                    {id: 3, nom: 'Betclic', soldeInitial: 100}
                ];
            }
            
            const ops = localStorage.getItem('operations');
            if (ops) operations = JSON.parse(ops);
            
            const tips = localStorage.getItem('tipsters');
            if (tips) tipsters = JSON.parse(tips);
        }

        function updateUI() {
            updateSelects();
            renderBookmakers();
            renderOperations();
            renderTipsters();
            renderStats();
            
            // D√©finir la date et heure actuelles par d√©faut
            const now = new Date();
            document.getElementById('dateOperation').value = now.toISOString().split('T')[0];
            document.getElementById('heureOperation').value = now.toTimeString().slice(0, 5);
        }

        // === √âCOUTEUR D'AUTHENTIFICATION ===
        auth.onAuthStateChanged((user) => {
            currentUser = user;
            if (user) {
                showAppUI(user);
            } else {
                showAuthUI();
            }
        });

        // === INITIALISATION ===
        window.addEventListener('DOMContentLoaded', function() {
            // Charger d'abord depuis localStorage
            loadDataFromLocalStorage();
            setupEvents();
            
            // L'authentification se fera automatiquement via onAuthStateChanged
        });

        // === VOS FONCTIONS EXISTANTES (CONSERVEZ TOUTES LES FONCTIONS EXISTANTES) ===
        // [TOUTES VOS FONCTIONS EXISTANTES RESTENT IDENTIQUES]
        function setupEvents() {
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.tab-button, .tab-content').forEach(el => el.classList.remove('active'));
                    this.classList.add('active');
                    document.getElementById(this.dataset.tab).classList.add('active');
                    if (this.dataset.tab === 'statistiques') renderStats();
                    if (this.dataset.tab === 'bookmakers') renderBookmakers();
                    if (this.dataset.tab === 'suivi-operations') renderOperations();
                    if (this.dataset.tab === 'tipsters') renderTipsters();
                });
            });

            document.getElementById('operationType').addEventListener('change', function() {
                if (this.value === 'Pari') {
                    document.getElementById('pariFields').style.display = 'block';
                    document.getElementById('depotRetraitFields').style.display = 'none';
                } else {
                    document.getElementById('pariFields').style.display = 'none';
                    document.getElementById('depotRetraitFields').style.display = 'block';
                }
            });

            document.getElementById('mise').addEventListener('input', calcGain);
            document.getElementById('cote').addEventListener('input', calcGain);

            document.getElementById('matchSearch').addEventListener('input', function() {
                clearTimeout(searchTimeout);
                const q = this.value.toLowerCase();
                if (q.length < 2) {
                    document.getElementById('autocompleteResults').classList.remove('active');
                    return;
                }
                searchTimeout = setTimeout(() => {
                    const results = mockMatches.filter(m => m.home.toLowerCase().includes(q) || m.away.toLowerCase().includes(q));
                    showResults(results);
                }, 300);
            });

            document.getElementById('sport').addEventListener('input', function() {
                const value = this.value;
                if (value.length === 1) {
                    const completed = autoCompleteSport(value);
                    if (completed !== value) {
                        this.value = completed;
                    }
                }
            });
        }

        function autoCompleteSport(input) {
            const sportMap = {
                'F': 'Football', 'B': 'Basketball', 'V': 'Volley', 
                'R': 'Rugby', '1': 'F1', 'H': 'Hockey'
            };
            return sportMap[input.toUpperCase()] || input;
        }

        function updateSelects() {
            const bookHtml = bookmakers.map(b => `<option value="${b.nom}">${b.nom}</option>`).join('');
            document.getElementById('operationBookmaker').innerHTML = '<option value="">S√©lectionner</option>' + bookHtml;
            
            const tipHtml = tipsters.map(t => `<option value="${t.id}">${t.nom}</option>`).join('');
            document.getElementById('operationTipster').innerHTML = '<option value="">Aucun / Personnel</option>' + tipHtml;
        }

        function calcGain() {
            const mise = parseFloat(document.getElementById('mise').value) || 0;
            const cote = parseFloat(document.getElementById('cote').value) || 0;
            const gainNet = (mise * cote) - mise;
            document.getElementById('gainPotentiel').textContent = gainNet.toFixed(2) + ' ‚Ç¨';
        }

        function showResults(results) {
            const container = document.getElementById('autocompleteResults');
            if (results.length === 0) {
                container.innerHTML = '<div style="padding: 12px 15px; color: #9ca3af;">Aucun r√©sultat</div>';
            } else {
                container.innerHTML = results.map(m => `<div class="autocomplete-item" onclick='selectMatch(${JSON.stringify(m)})'><div class="match-info">‚öΩ ${m.home} vs ${m.away}</div><div class="match-meta">${m.date} √† ${m.time}</div></div>`).join('');
            }
            container.classList.add('active');
        }

        function selectMatch(match) {
            document.getElementById('sport').value = match.sport;
            document.getElementById('match').value = `${match.home} vs ${match.away}`;
            document.getElementById('dateOperation').value = match.date;
            document.getElementById('heureOperation').value = match.time;
            document.getElementById('selection').value = match.home;
            document.getElementById('matchSearch').value = `${match.home} vs ${match.away}`;
            document.getElementById('autocompleteResults').classList.remove('active');
        }

        function saveOperation() {
            const type = document.getElementById('operationType').value;
            const bookmaker = document.getElementById('operationBookmaker').value;
            if (!bookmaker) { alert('Veuillez s√©lectionner un bookmaker'); return; }
            
            let op;
            if (editingOperationId) {
                op = operations.find(o => o.id === editingOperationId);
                if (!op) return;
            } else {
                op = { id: Date.now() };
                operations.push(op);
            }
            
            const dateOp = document.getElementById('dateOperation').value;
            const heureOp = document.getElementById('heureOperation').value;
            op.dateOperation = dateOp || new Date().toISOString().split('T')[0];
            op.heureOperation = heureOp || new Date().toTimeString().slice(0, 5);
            op.dateCreation = new Date().toISOString();
            
            op.type = type;
            op.bookmaker = bookmaker;
            
            if (type === 'Pari') {
                const mise = document.getElementById('mise').value;
                const cote = document.getElementById('cote').value;
                if (!mise || !cote) { alert('Remplissez mise et c√¥te'); return; }
                op.sport = document.getElementById('sport').value;
                op.match = document.getElementById('match').value;
                op.mise = parseFloat(mise);
                op.cote = parseFloat(cote);
                op.statut = document.getElementById('statut').value;
                op.tipster = document.getElementById('operationTipster').value;
                op.typePari = document.getElementById('typePari').value;
                op.selection = document.getElementById('selection').value;
            } else {
                const montant = document.getElementById('montant').value;
                if (!montant) { alert('Saisissez un montant'); return; }
                op.montant = parseFloat(montant);
            }
            
            saveData();
            alert(editingOperationId ? '‚úÖ Op√©ration modifi√©e !' : '‚úÖ Op√©ration enregistr√©e !');
            resetForm();
            renderOperations();
            renderBookmakers();
            renderTipsters();
            renderStats();
        }

        // [TOUTES VOS AUTRES FONCTIONS EXISTANTES...]
        // renderOperations(), renderBookmakers(), renderTipsters(), etc.
        // Ces fonctions restent identiques √† votre version pr√©c√©dente

    </script>
</body>
</html>
