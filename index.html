<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suivi de bankroll</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1800px; margin: 0 auto; }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        
        /* CORRECTION DES ONGLETS POUR MOBILE */
        .tabs-container {
            background: white;
            border-radius: 12px 12px 0 0;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
        }
        .tabs { 
            display: flex;
            overflow-x: auto;
            overflow-y: hidden;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
            white-space: nowrap;
            -webkit-overflow-scrolling: touch; /* iOS smooth scrolling */
        }
        .tabs::-webkit-scrollbar {
            display: none; /* Chrome, Safari and Opera */
        }
        .tab-button { 
            flex: 0 0 auto; /* Emp√™che le flex-shrink */
            padding: 18px 20px;
            background: white;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #6b7280;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            min-width: 140px; /* Largeur minimale pour √™tre cliquable sur mobile */
        }
        .tab-button:hover { background: #f9fafb; color: #3b82f6; }
        .tab-button.active { color: #3b82f6; border-bottom-color: #3b82f6; background: #eff6ff; }
        
        /* Indicateur de scroll pour mobile */
        .scroll-indicator {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 30px;
            background: linear-gradient(90deg, transparent, white);
            display: none;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }
        .scroll-indicator::after {
            content: '‚Ä∫';
            font-size: 1.5rem;
            color: #3b82f6;
            font-weight: bold;
        }
        
        .tab-content { display: none; background: white; padding: 20px; border-radius: 0 0 12px 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .tab-content.active { display: block; }
        
        /* Ajustements pour mobile */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .header h1 { font-size: 2rem; }
            .tab-content { padding: 15px; }
            .card { padding: 20px; }
            .form-grid { grid-template-columns: 1fr; gap: 15px; }
            .stats-grid { grid-template-columns: 1fr; }
            .tabs { padding-bottom: 5px; } /* Espace pour le scroll */
            .scroll-indicator { display: flex; }
        }
        
        @media (max-width: 480px) {
            .tab-button { 
                padding: 15px 16px;
                font-size: 0.9rem;
                min-width: 120px;
            }
            .header h1 { font-size: 1.8rem; }
        }

        .card { background: white; padding: 25px; border-radius: 12px; margin-bottom: 20px; }
        .card-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 10px; }
        .card-description { color: #6b7280; margin-bottom: 20px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .form-group { display: flex; flex-direction: column; position: relative; }
        label { font-weight: 600; margin-bottom: 8px; color: #374151; }
        input, select { padding: 12px 15px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; font-family: inherit; }
        input:focus, select:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-primary:hover { background: #2563eb; }
        .btn-success { background: #22c55e; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-secondary { background: #6b7280; color: white; }
        .btn-warning { background: #f59e0b; color: white; }
        .btn-info { background: #06b6d4; color: white; }
        .btn-sm { padding: 6px 12px; font-size: 0.875rem; }
        .btn-block { width: 100%; }
        .gain-display { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color: white; padding: 15px; border-radius: 8px; font-size: 1.5rem; font-weight: 700; text-align: center; }
        .autocomplete-container { position: relative; }
        .autocomplete-results { display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 2px solid #3b82f6; border-top: none; border-radius: 0 0 8px 8px; max-height: 300px; overflow-y: auto; z-index: 100; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .autocomplete-results.active { display: block; }
        .autocomplete-item { padding: 12px 15px; cursor: pointer; border-bottom: 1px solid #f3f4f6; }
        .autocomplete-item:hover { background: #eff6ff; }
        .match-info { font-weight: 600; color: #1f2937; }
        .match-meta { font-size: 0.875rem; color: #6b7280; margin-top: 4px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.9rem; }
        th { background: #f9fafb; padding: 12px 8px; text-align: left; font-weight: 600; border-bottom: 2px solid #e5e7eb; white-space: nowrap; }
        td { padding: 12px 8px; border-bottom: 1px solid #f3f4f6; vertical-align: top; }
        tr:hover { background: #f9fafb; }
        .badge { display: inline-block; padding: 4px 8px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; }
        .badge-success { background: #dcfce7; color: #166534; }
        .badge-danger { background: #fee2e2; color: #991b1b; }
        .badge-warning { background: #fed7aa; color: #9a3412; }
        .badge-info { background: #dbeafe; color: #1e40af; }
        .badge-secondary { background: #f3f4f6; color: #374151; }
        .bookmaker-list { display: grid; gap: 15px; margin-bottom: 20px; }
        .bookmaker-item { display: flex; justify-content: space-between; align-items: center; padding: 20px; background: #f9fafb; border-radius: 8px; border: 2px solid #e5e7eb; }
        .bookmaker-name { font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
        .bookmaker-balance { color: #6b7280; }
        .bookmaker-current { font-size: 1.5rem; font-weight: 700; color: #3b82f6; margin-right: 20px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; padding: 25px; border-radius: 12px; }
        .stat-card.green { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); }
        .stat-card.red { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .stat-card.purple { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
        .stat-label { font-size: 0.95rem; opacity: 0.9; margin-bottom: 8px; }
        .stat-value { font-size: 2rem; font-weight: 700; }
        .action-buttons { display: flex; gap: 4px; flex-wrap: wrap; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; padding: 30px; border-radius: 12px; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .modal-header { font-size: 1.5rem; font-weight: 700; margin-bottom: 20px; }
        .modal-buttons { display: flex; gap: 10px; margin-top: 20px; }
        .edit-mode-banner { background: #fef3c7; color: #92400e; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-weight: 600; text-align: center; }
        .reset-zone { margin-top: 30px; padding-top: 30px; border-top: 2px solid #fee2e2; }
        .export-buttons { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .tipster-card { background: #f9fafb; padding: 20px; border-radius: 8px; border: 2px solid #e5e7eb; margin-bottom: 15px; cursor: pointer; transition: all 0.2s; }
        .tipster-card:hover { border-color: #3b82f6; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15); }
        .tipster-card.selected { border-color: #3b82f6; background: #eff6ff; }
        .tipster-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .tipster-name { font-size: 1.3rem; font-weight: 700; color: #1f2937; }
        .tipster-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; font-size: 0.9rem; }
        .tipster-stat { text-align: center; }
        .tipster-stat-value { font-weight: 700; color: #3b82f6; }
        .tipster-stat-label { color: #6b7280; font-size: 0.85rem; }
        .sport-icon { width: 20px; height: 20px; display: inline-block; text-align: center; font-weight: bold; margin-right: 5px; }
        
        /* Styles pour Firebase Auth */
        .auth-container { background: white; padding: 30px; border-radius: 12px; margin-bottom: 20px; text-align: center; }
        .user-info { background: #eff6ff; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .sync-status { position: fixed; top: 20px; right: 20px; background: white; padding: 10px 15px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; font-size: 0.9rem; }
        .sync-status.syncing { background: #fef3c7; color: #92400e; }
        .sync-status.synced { background: #dcfce7; color: #166534; }
        .sync-status.error { background: #fee2e2; color: #991b1b; }
        .offline-mode { background: #fef3c7; color: #92400e; }
        
        /* Loader pour mobile */
        .mobile-loader {
            display: none;
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }
        .mobile-loader.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Barre de statut de synchronisation -->
        <div class="sync-status" id="syncStatus" style="display: none;">
            üîÑ Synchronisation...
        </div>

        <div class="header">
            <h1>üí∞ Suivi de bankroll</h1>
            <p>G√©rez vos paris sportifs et suivez vos performances</p>
        </div>

        <!-- Loader pour mobile -->
        <div class="mobile-loader" id="mobileLoader">
            <div style="font-size: 2rem; margin-bottom: 20px;">‚è≥</div>
            <h3>Chargement des donn√©es...</h3>
            <p>Veuillez patienter</p>
        </div>

        <!-- Section Authentification -->
        <div class="auth-container" id="authContainer">
            <h2>üîê Connexion</h2>
            <p>Connectez-vous pour synchroniser vos donn√©es sur tous vos appareils</p>
            <div class="form-grid" style="max-width: 400px; margin: 20px auto;">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="authEmail" placeholder="votre@email.com">
                </div>
                <div class="form-group">
                    <label>Mot de passe</label>
                    <input type="password" id="authPassword" placeholder="Votre mot de passe">
                </div>
            </div>
            <button class="btn btn-primary" onclick="login()">Se connecter</button>
            <button class="btn btn-secondary" onclick="signup()">Cr√©er un compte</button>
            <div style="margin-top: 15px; font-size: 0.9rem; color: #6b7280;">
                <p>Ou utilisez un compte anonyme :</p>
                <button class="btn btn-info btn-sm" onclick="loginAnonymously()">Utiliser sans compte</button>
            </div>
        </div>

        <!-- Info utilisateur connect√© -->
        <div class="user-info" id="userInfo" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <strong>Connect√© en tant que :</strong> 
                    <span id="userEmail"></span>
                    <span id="userAnonymous" style="font-style: italic; color: #6b7280;"></span>
                </div>
                <button class="btn btn-danger btn-sm" onclick="logout()">D√©connexion</button>
            </div>
        </div>

        <!-- Le reste de votre application - CORRIG√â POUR MOBILE -->
        <div class="tabs-container" id="appContent" style="display: none;">
            <div class="tabs" id="mainTabs">
                <button class="tab-button active" data-tab="enregistrer">Enregistrer</button>
                <button class="tab-button" data-tab="suivi-operations">Suivi</button>
                <button class="tab-button" data-tab="tipsters">Tipsters</button>
                <button class="tab-button" data-tab="bookmakers">Bookmakers</button>
                <button class="tab-button" data-tab="statistiques">Stats</button>
                <button class="tab-button" data-tab="outils">Outils</button>
                <button class="tab-button" data-tab="reglages">R√©glages</button>
            </div>
            <div class="scroll-indicator" id="scrollIndicator"></div>
        </div>
        
        <!-- Onglet Enregistrer -->
        <div class="tab-content active" id="enregistrer">
            <div class="card">
                <div id="editModeBanner" class="edit-mode-banner" style="display: none;">
                    üìù Mode modification activ√© - Les donn√©es actuelles sont conserv√©es
                </div>
                <h2 class="card-title">Enregistrer une op√©ration</h2>
                <p class="card-description">Ajoutez un nouveau pari, d√©p√¥t, retrait ou frais</p>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Type d'op√©ration</label>
                        <select id="operationType">
                            <option value="Pari">Pari</option>
                            <option value="D√©p√¥t">D√©p√¥t</option>
                            <option value="Retrait">Retrait</option>
                            <option value="Frais">Frais</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Bookmaker</label>
                        <select id="operationBookmaker"><option value="">S√©lectionner un bookmaker</option></select>
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="dateOperation" value="">
                    </div>
                    <div class="form-group">
                        <label>Heure</label>
                        <input type="time" id="heureOperation" value="">
                    </div>
                </div>
                <div id="pariFields">
                    <div class="form-group">
                        <label>Tipster (optionnel)</label>
                        <select id="operationTipster">
                            <option value="">Aucun / Personnel</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Rechercher un match</label>
                        <div class="autocomplete-container">
                            <input type="text" id="matchSearch" placeholder="Tapez le nom d'une √©quipe (ex: Barnsley, PSG...)">
                            <div class="autocomplete-results" id="autocompleteResults"></div>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Sport</label>
                            <input type="text" id="sport" placeholder="Football, Tennis...">
                        </div>
                        <div class="form-group">
                            <label>Match</label>
                            <input type="text" id="match" placeholder="PSG vs OM">
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group"><label>√âquipe / S√©lection</label><input type="text" id="selection" placeholder="PSG"></div>
                        <div class="form-group">
                            <label>Type de pari</label>
                            <select id="typePari">
                                <option value="Simple">Simple</option>
                                <option value="Multiple">Multiple</option>
                                <option value="Score exact">Score exact</option>
                                <option value="Points">Points</option>
                                <option value="Marqueur">Marqueur</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group"><label>Mise (‚Ç¨)</label><input type="number" id="mise" step="0.01" placeholder="0.00"></div>
                        <div class="form-group"><label>C√¥te</label><input type="number" id="cote" step="0.01" placeholder="1.50"></div>
                        <div class="form-group"><label>Gain net (‚Ç¨)</label><div class="gain-display" id="gainPotentiel">0.00 ‚Ç¨</div></div>
                    </div>
                    <div class="form-group">
                        <label>Statut</label>
                        <select id="statut">
                            <option value="En cours">En cours</option>
                            <option value="Gagn√©">Gagn√©</option>
                            <option value="Perdu">Perdu</option>
                            <option value="Rembours√©">Rembours√©</option>
                        </select>
                    </div>
                </div>
                <div id="depotRetraitFields" style="display: none;">
                    <div class="form-group"><label>Montant (‚Ç¨)</label><input type="number" id="montant" step="0.01" placeholder="0.00"></div>
                </div>
                <button class="btn btn-primary btn-block" onclick="saveOperation()">Enregistrer</button>
                <button id="cancelEditBtn" class="btn btn-secondary btn-block" onclick="cancelEdit()" style="display: none; margin-top: 10px;">Annuler la modification</button>
            </div>
        </div>
        
        <!-- Onglet Suivi des op√©rations -->
        <div class="tab-content" id="suivi-operations">
            <div class="card">
                <h2 class="card-title">Suivi des op√©rations</h2>
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>Date/Heure</th>
                                <th>Type</th>
                                <th>Bookmaker</th>
                                <th>Sport</th>
                                <th>Match</th>
                                <th>√âquipe/S√©lection</th>
                                <th>Type pari</th>
                                <th>Tipster</th>
                                <th>Mise</th>
                                <th>C√¥te</th>
                                <th>Statut</th>
                                <th>R√©sultat</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="operationsTableBody">
                            <tr><td colspan="13" style="text-align: center; color: #9ca3af; padding: 40px;">Aucune op√©ration</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Onglet Tipsters -->
        <div class="tab-content" id="tipsters">
            <div class="card">
                <h2 class="card-title">Tipsters</h2>
                <p class="card-description">G√©rez vos tipsters et suivez leurs performances</p>
                <div id="tipsterList"></div>
                <button class="btn btn-primary" onclick="showTipsterForm()">Ajouter un tipster</button>
                <div id="tipsterFormContainer" style="display: none; margin-top: 20px;">
                    <h3 id="tipsterFormTitle">Nouveau Tipster</h3>
                    <div class="form-grid">
                        <div class="form-group"><label>Nom du tipster</label><input type="text" id="tipsterNom"></div>
                        <div class="form-group"><label>Description (optionnel)</label><input type="text" id="tipsterDescription" placeholder="Ex: Twitter @pseudo"></div>
                    </div>
                    <button class="btn btn-primary" onclick="saveTipster()">Enregistrer</button>
                    <button class="btn btn-secondary" onclick="cancelTipsterForm()">Annuler</button>
                </div>
                <div id="tipsterDetailsContainer" style="display: none; margin-top: 30px;">
                    <h3 id="tipsterDetailsTitle"></h3>
                    <div class="stats-grid" id="tipsterDetailsStats"></div>
                    <button class="btn btn-secondary" onclick="closeTipsterDetails()">Retour</button>
                </div>
            </div>
        </div>
        
        <!-- Onglet Bookmakers -->
        <div class="tab-content" id="bookmakers">
            <div class="card">
                <h2 class="card-title">Bookmakers</h2>
                <div class="bookmaker-list" id="bookmakerList"></div>
                <button class="btn btn-primary" onclick="showBookmakerForm()">Ajouter un bookmaker</button>
                <div id="bookmakerFormContainer" style="display: none; margin-top: 20px;">
                    <h3 id="bookmakerFormTitle">Nouveau Bookmaker</h3>
                    <div class="form-grid">
                        <div class="form-group"><label>Nom</label><input type="text" id="bookmakerNom"></div>
                        <div class="form-group"><label>Solde initial (‚Ç¨)</label><input type="number" id="bookmakerSolde" step="0.01"></div>
                    </div>
                    <button class="btn btn-primary" onclick="saveBookmaker()">Enregistrer</button>
                    <button class="btn btn-secondary" onclick="cancelBookmakerForm()">Annuler</button>
                </div>
            </div>
        </div>
        
        <!-- Onglet Statistiques -->
        <div class="tab-content" id="statistiques">
            <div class="card">
                <h2 class="card-title">Statistiques</h2>
                <div class="stats-grid" id="statsGrid"></div>
            </div>
        </div>
        
        <!-- Onglet Outils -->
        <div class="tab-content" id="outils">
            <div class="card">
                <h2 class="card-title">üõ†Ô∏è Outils</h2>
                <p class="card-description">Section en construction - Bient√¥t de nouvelles fonctionnalit√©s !</p>
                <div style="text-align: center; padding: 60px 20px; color: #6b7280;">
                    <div style="font-size: 3rem; margin-bottom: 20px;">üîß</div>
                    <h3 style="margin-bottom: 10px;">Fonctionnalit√©s √† venir</h3>
                    <p>Nous travaillons sur de nouveaux outils pour am√©liorer votre exp√©rience.</p>
                </div>
            </div>
        </div>
        
        <!-- Onglet R√©glages -->
        <div class="tab-content" id="reglages">
            <div class="card">
                <h2 class="card-title">‚öôÔ∏è R√©glages</h2>
                <p class="card-description">G√©rez vos donn√©es et param√®tres</p>
                
                <div class="export-buttons">
                    <button class="btn btn-success" onclick="exportData()">üì• Exporter les donn√©es</button>
                    <button class="btn btn-primary" onclick="document.getElementById('importFile').click()">üì§ Importer les donn√©es</button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                </div>
                
                <div class="reset-zone">
                    <h3 style="color: #dc2626; margin-bottom: 15px;">‚ö†Ô∏è Zone dangereuse</h3>
                    <p style="color: #6b7280; margin-bottom: 15px;">Cette action supprimera toutes vos donn√©es de mani√®re irr√©versible.</p>
                    <button class="btn btn-danger" onclick="resetApp()">üóëÔ∏è R√©initialiser l'application</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Cash-out -->
    <div class="modal" id="cashoutModal">
        <div class="modal-content">
            <div class="modal-header">üí∞ Cash-out</div>
            <div class="form-group">
                <label>Montant du cash-out (‚Ç¨)</label>
                <input type="number" id="cashoutAmount" step="0.01" placeholder="0.00">
            </div>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="confirmCashout()">Valider</button>
                <button class="btn btn-secondary" onclick="closeCashoutModal()">Annuler</button>
            </div>
        </div>
    </div>

    <script>
        // === CONFIGURATION FIREBASE SIMPLIFI√âE ===
        const firebaseConfig = {
            apiKey: "AIzaSyDbtGDuOVE4lYkVtLjZ0AnrpbWVnwcdvZI",
            authDomain: "bankroll-suivi.firebaseapp.com",
            databaseURL: "https://bankroll-suivi-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "bankroll-suivi",
            storageBucket: "bankroll-suivi.firebasestorage.app",
            messagingSenderId: "632546496211",
            appId: "1:632546496211:web:25375f3e496c4a43490e26"
        };

        // Variables globales
        let bookmakers = [];
        let operations = [];
        let tipsters = [];
        let searchTimeout = null;
        let currentCashoutId = null;
        let editingOperationId = null;
        let editingTipsterId = null;
        let editingBookmakerId = null;
        let isSyncing = false;
        let currentUser = null;
        let auth = null;
        let database = null;
        let isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

        const mockMatches = [
            {sport: 'Football', home: 'Barnsley', away: 'Lincoln', date: '2025-11-15', time: '20:00'},
            {sport: 'Football', home: 'PSG', away: 'OM', date: '2025-11-16', time: '21:00'},
            {sport: 'Football', home: 'Real Madrid', away: 'Barcelona', date: '2025-11-17', time: '20:00'},
            {sport: 'Football', home: 'Manchester United', away: 'Liverpool', date: '2025-11-18', time: '17:30'},
            {sport: 'Football', home: 'Bayern', away: 'Dortmund', date: '2025-11-19', time: '18:30'},
            {sport: 'Football', home: 'Arsenal', away: 'Chelsea', date: '2025-11-22', time: '16:00'}
        ];

        const sportIcons = {
            'Football': '‚öΩ', 'Basketball': 'üèÄ', 'Tennis': 'üéæ', 'Rugby': 'üèâ',
            'Hockey': 'üèí', 'Volley': 'üèê', 'F1': 'üèéÔ∏è', 'Baseball': '‚öæ',
            'Golf': '‚õ≥', 'Boxe': 'ü•ä'
        };

        // === D√âTECTION MOBILE ET INITIALISATION ===
        function initializeApp() {
            console.log('D√©marrage sur:', isMobile ? 'Mobile' : 'Desktop');
            
            if (isMobile) {
                document.getElementById('mobileLoader').classList.add('active');
            }
            
            try {
                // Initialiser Firebase
                firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                database = firebase.database();
                console.log('Firebase initialis√© avec succ√®s');
                
                // Configurer l'√©couteur d'authentification
                auth.onAuthStateChanged((user) => {
                    currentUser = user;
                    if (user) {
                        showAppUI(user);
                    } else {
                        showAuthUI();
                    }
                }, (error) => {
                    console.error('Erreur auth:', error);
                    showLocalMode();
                });
                
            } catch (error) {
                console.error('Erreur initialisation Firebase:', error);
                showLocalMode();
            }
        }

        // === MODE LOCAL SANS FIREBASE ===
        function showLocalMode() {
            console.log('Mode local activ√©');
            
            // Masquer le loader mobile
            if (isMobile) {
                document.getElementById('mobileLoader').classList.remove('active');
            }
            
            loadDataFromLocalStorage();
            updateUI();
            
            // Afficher directement l'application
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('userInfo').style.display = 'none';
            document.getElementById('appContent').style.display = 'block';
            document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
            document.getElementById('enregistrer').style.display = 'block';
            
            showSyncStatus('üì± Mode local - Donn√©es locales', 'synced');
        }

        function showAuthUI() {
            // Masquer le loader mobile
            if (isMobile) {
                document.getElementById('mobileLoader').classList.remove('active');
            }
            
            document.getElementById('authContainer').style.display = 'block';
            document.getElementById('userInfo').style.display = 'none';
            document.getElementById('appContent').style.display = 'none';
        }

        function showAppUI(user) {
            // Masquer le loader mobile
            if (isMobile) {
                document.getElementById('mobileLoader').classList.remove('active');
            }
            
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('userInfo').style.display = 'block';
            document.getElementById('appContent').style.display = 'block';
            
            const userEmail = document.getElementById('userEmail');
            const userAnonymous = document.getElementById('userAnonymous');
            
            if (user.isAnonymous) {
                userEmail.textContent = '';
                userAnonymous.textContent = 'Compte anonyme';
            } else {
                userEmail.textContent = user.email;
                userAnonymous.textContent = '';
            }
            
            document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
            document.getElementById('enregistrer').style.display = 'block';
            
            loadUserData();
        }

        // === GESTION DES DONN√âES AM√âLIOR√âE POUR MOBILE ===
        function loadDataFromLocalStorage() {
            try {
                console.log('Chargement des donn√©es locales...');
                
                const savedBookmakers = localStorage.getItem('bookmakers');
                const savedOperations = localStorage.getItem('operations');
                const savedTipsters = localStorage.getItem('tipsters');
                
                if (savedBookmakers) { 
                    bookmakers = JSON.parse(savedBookmakers);
                    console.log('Bookmakers charg√©s:', bookmakers.length);
                } else {
                    bookmakers = [
                        {id: 1, nom: 'Loro', soldeInitial: 100},
                        {id: 2, nom: 'bet365', soldeInitial: 100},
                        {id: 3, nom: 'Betclic', soldeInitial: 100}
                    ];
                    console.log('Bookmakers par d√©faut cr√©√©s');
                }
                
                if (savedOperations) {
                    operations = JSON.parse(savedOperations);
                    console.log('Op√©rations charg√©es:', operations.length);
                } else {
                    operations = [];
                    console.log('Aucune op√©ration trouv√©e');
                }
                
                if (savedTipsters) {
                    tipsters = JSON.parse(savedTipsters);
                    console.log('Tipsters charg√©s:', tipsters.length);
                } else {
                    tipsters = [];
                    console.log('Aucun tipster trouv√©');
                }
                
            } catch (error) {
                console.error('Erreur chargement local:', error);
                // R√©initialiser avec des donn√©es par d√©faut
                bookmakers = [
                    {id: 1, nom: 'Loro', soldeInitial: 100},
                    {id: 2, nom: 'bet365', soldeInitial: 100},
                    {id: 3, nom: 'Betclic', soldeInitial: 100}
                ];
                operations = [];
                tipsters = [];
                console.log('Donn√©es r√©initialis√©es suite √† une erreur');
            }
        }

        function saveDataToLocalStorage() {
            try {
                localStorage.setItem('bookmakers', JSON.stringify(bookmakers));
                localStorage.setItem('operations', JSON.stringify(operations));
                localStorage.setItem('tipsters', JSON.stringify(tipsters));
                console.log('Donn√©es sauvegard√©es localement');
            } catch (error) {
                console.error('Erreur sauvegarde locale:', error);
                alert('Erreur lors de la sauvegarde des donn√©es');
            }
        }

        async function loadUserData() {
            if (!currentUser || !database) {
                loadDataFromLocalStorage();
                updateUI();
                return;
            }
            
            showSyncStatus('üîÑ Chargement...', 'syncing');
            
            try {
                const userDataPath = `users/${currentUser.uid}`;
                const snapshot = await database.ref(userDataPath).once('value');
                const data = snapshot.val();
                
                if (data) {
                    bookmakers = data.bookmakers || [];
                    operations = data.operations || [];
                    tipsters = data.tipsters || [];
                    console.log('Donn√©es Firebase charg√©es:', {
                        bookmakers: bookmakers.length,
                        operations: operations.length,
                        tipsters: tipsters.length
                    });
                    showSyncStatus('‚úÖ Donn√©es charg√©es', 'synced');
                } else {
                    console.log('Aucune donn√©e Firebase, utilisation des donn√©es locales');
                    loadDataFromLocalStorage();
                }
                
                updateUI();
            } catch (error) {
                console.error('Erreur chargement Firebase:', error);
                loadDataFromLocalStorage();
                updateUI();
                showSyncStatus('‚ö†Ô∏è Donn√©es locales charg√©es', 'synced');
            }
        }

        function updateUI() {
            console.log('Mise √† jour de l interface...');
            try {
                updateSelects();
                renderBookmakers();
                renderOperations();
                renderTipsters();
                renderStats();
                
                const now = new Date();
                document.getElementById('dateOperation').value = now.toISOString().split('T')[0];
                document.getElementById('heureOperation').value = now.toTimeString().slice(0, 5);
                
                console.log('Interface mise √† jour avec succ√®s');
            } catch (error) {
                console.error('Erreur mise √† jour UI:', error);
            }
        }

        // === INITIALISATION ===
        window.addEventListener('DOMContentLoaded', function() {
            console.log('D√©marrage de l application...');
            setupEvents();
            initializeApp();
            
            // Gestion du scroll pour les onglets sur mobile
            setupTabsScroll();
        });

        // === GESTION DU SCROLL DES ONGLETS ===
        function setupTabsScroll() {
            const tabs = document.getElementById('mainTabs');
            const indicator = document.getElementById('scrollIndicator');
            
            if (tabs && indicator) {
                tabs.addEventListener('scroll', function() {
                    // Masquer l'indicateur si on est √† la fin
                    const isAtEnd = tabs.scrollLeft + tabs.clientWidth >= tabs.scrollWidth - 10;
                    indicator.style.display = isAtEnd ? 'none' : 'flex';
                });
                
                // V√©rifier l'√©tat initial
                setTimeout(() => {
                    const isAtEnd = tabs.scrollLeft + tabs.clientWidth >= tabs.scrollWidth - 10;
                    indicator.style.display = isAtEnd ? 'none' : 'flex';
                }, 100);
            }
        }

        // === FONCTIONS EXISTANTES (elles restent identiques) ===
        function setupEvents() {
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.tab-button, .tab-content').forEach(el => {
                        el.classList.remove('active');
                        if (el.classList.contains('tab-content')) {
                            el.style.display = 'none';
                        }
                    });
                    this.classList.add('active');
                    const tabContent = document.getElementById(this.dataset.tab);
                    tabContent.classList.add('active');
                    tabContent.style.display = 'block';
                    
                    if (this.dataset.tab === 'statistiques') renderStats();
                    if (this.dataset.tab === 'bookmakers') renderBookmakers();
                    if (this.dataset.tab === 'suivi-operations') renderOperations();
                    if (this.dataset.tab === 'tipsters') renderTipsters();
                });
            });

            document.getElementById('operationType').addEventListener('change', function() {
                if (this.value === 'Pari') {
                    document.getElementById('pariFields').style.display = 'block';
                    document.getElementById('depotRetraitFields').style.display = 'none';
                } else {
                    document.getElementById('pariFields').style.display = 'none';
                    document.getElementById('depotRetraitFields').style.display = 'block';
                }
            });

            document.getElementById('mise').addEventListener('input', calcGain);
            document.getElementById('cote').addEventListener('input', calcGain);

            document.getElementById('matchSearch').addEventListener('input', function() {
                clearTimeout(searchTimeout);
                const q = this.value.toLowerCase();
                if (q.length < 2) {
                    document.getElementById('autocompleteResults').classList.remove('active');
                    return;
                }
                searchTimeout = setTimeout(() => {
                    const results = mockMatches.filter(m => m.home.toLowerCase().includes(q) || m.away.toLowerCase().includes(q));
                    showResults(results);
                }, 300);
            });

            document.getElementById('sport').addEventListener('input', function() {
                const value = this.value;
                if (value.length === 1) {
                    const completed = autoCompleteSport(value);
                    if (completed !== value) {
                        this.value = completed;
                    }
                }
            });
        }

        // ... (TOUTES LES AUTRES FONCTIONS RESTENT IDENTIQUES)
        // [VOS FONCTIONS EXISTANTES SAUVEGARD√âES]

    </script>
</body>
</html>
